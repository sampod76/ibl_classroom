name: ibl_classroom

on:
  push:
    branches: [main]

# âœ… One deploy at a time per branch; newer runs cancel older ones
concurrency:
  group: ibl_classroom:${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  deploy:
    name: Deploy to VPS dockers
    runs-on: ubuntu-latest
    timeout-minutes: 40

    steps:
      - name: ðŸ§  Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: ðŸš€ Deploy to VPS (SSH Key-based)
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22
          script_stop: true
          # If your deploy sometimes takes longer, adjust this:
          command_timeout: 30m
          script: |
            bash /home/sampod/apps/ibl_classroom/deploy_client.sh
